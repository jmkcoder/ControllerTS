{% extends "shared/_base.njk" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
  <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
    <h3>Navigation</h3>
    <nav>
      <a href="/" style="margin-right: 15px; padding: 8px 12px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px;">Home</a>
      <a href="/about" style="margin-right: 15px; padding: 8px 12px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px;">About</a>
      <a href="/home/demo" style="margin-right: 15px; padding: 8px 12px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">Demo Action</a>
      <a href="/home/partials-demo" style="margin-right: 15px; padding: 8px 12px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;">Partials Demo</a>
      <a href="/home/json" style="margin-right: 15px; padding: 8px 12px; background: #17a2b8; color: white; text-decoration: none; border-radius: 4px;">JSON Demo</a>
    </nav>
  </div>

  <h1>{{ title }}</h1>
  <p class="subtitle">{{ subtitle or message }}</p>
  
  {% if currentUser %}
    <div class="user-info">
      <h3>👤 Current User (from UserService)</h3>
      <ul>
        <li><strong>ID:</strong> {{ currentUser.id }}</li>
        <li><strong>Name:</strong> {{ currentUser.name }}</li>
        <li><strong>Email:</strong> {{ currentUser.email }}</li>
      </ul>
    </div>
  {% endif %}

  {% if allUsers %}
    <div class="users-list">
      <h3>👥 All Users ({{ allUsers.length }})</h3>
      <ul>
        {% for user in allUsers %}
          <li>{{ user.name }} - {{ user.email }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% if diInfo %}
    <div class="di-info">
      <h3>💉 Dependency Injection Info</h3>
      <ul>
        <li><strong>UserService:</strong> {{ diInfo.userService }}</li>
        <li><strong>LoggerService:</strong> {{ diInfo.loggerService }}</li>
        <li><strong>EmailService:</strong> {{ diInfo.emailService }}</li>
      </ul>
    </div>
  {% endif %}

  {% if recentLogs %}
    <div class="logs">
      <h3>📝 Recent Log Entries</h3>
      <ul>
        {% for log in recentLogs %}
          <li><code>{{ log }}</code></li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
  
  <div id="details-section" style="margin: 20px 0; padding: 15px; background: #e7f3ff; border-radius: 4px;">
    <h3>Demo Action Details</h3>
    <p><strong>Timestamp:</strong> {{ timestamp }}</p>
    {% if data %}
    <p><strong>Data received:</strong></p>
    <pre style="background: #f1f1f1; padding: 10px; border-radius: 4px; overflow-x: auto;">{{ data | dump }}</pre>
    {% endif %}
  </div>

  <div id="features-section" style="margin: 20px 0;">
    <h3>🚀 Framework Features with DI</h3>
    <p>This page demonstrates:</p>
    <ul>
      <li>✅ Clean URL routing (/home/demo)</li>
      <li>✅ Controller action with view rendering</li>
      <li>✅ <strong>Dependency injection in controllers</strong></li>
      <li>✅ Service lifetimes (Singleton, Scoped, Transient)</li>
      <li>✅ Automatic service resolution</li>
      <li>✅ Client-side navigation without page reload</li>
    </ul>
  </div>

  <div class="actions">
    <h3>🎯 Test Actions</h3>
    <div class="button-group">
      <button onclick="loadContent('/home/demo')">🔄 Reload Demo</button>
      <button onclick="loadContent('/home/json')">📄 Get JSON Data</button>
      <button onclick="loadContent('/home')">🏠 Back to Home</button>
      <button onclick="testAjax()">🚀 Test AJAX Call</button>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
async function testAjax() {
  try {
    const response = await fetch('/home/json');
    const result = await response.json();
    alert('AJAX Response: ' + JSON.stringify(result, null, 2));
  } catch (error) {
    alert('Error: ' + error.message);
  }
}

function loadContent(url) {
  window.history.pushState({}, '', url);
  window.dispatchEvent(new PopStateEvent('popstate'));
}
</script>
{% endblock %}

{% block styles %}
<style>
.user-info, .users-list, .di-info, .logs, .actions {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
}

.user-info h3, .users-list h3, .di-info h3, .logs h3, .actions h3 {
  margin-top: 0;
  color: #495057;
}

.button-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.button-group button {
  background: #007bff;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.button-group button:hover {
  background: #0056b3;
}

.logs ul {
  background: #2d3748;
  color: #e2e8f0;
  padding: 15px;
  border-radius: 4px;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  max-height: 300px;
  overflow-y: auto;
}

.logs li {
  margin: 5px 0;
  list-style: none;
}

.subtitle {
  font-style: italic;
  color: #6c757d;
  margin-bottom: 20px;
}
</style>
{% endblock %}
