{% extends "shared/_base.njk" %}

{% block content %}
<div class="container">
  <h1>{{ title }}</h1>
  
  <!-- Search Form -->
  <div class="search-form">
    <form method="get" action="/home/search">
      <div class="form-group">
        <label for="query">Search Query:</label>
        <input type="text" id="query" name="q" value="{{ query }}" placeholder="Enter search terms...">
      </div>
      
      <div class="form-group">
        <label for="category">Category:</label>
        <select id="category" name="category">
          <option value="all" {% if category == 'all' %}selected{% endif %}>All Categories</option>
          <option value="programming" {% if category == 'programming' %}selected{% endif %}>Programming</option>
          <option value="architecture" {% if category == 'architecture' %}selected{% endif %}>Architecture</option>
          <option value="patterns" {% if category == 'patterns' %}selected{% endif %}>Patterns</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="pageSize">Results per page:</label>
        <select id="pageSize" name="pageSize">
          <option value="5" {% if pageSize == 5 %}selected{% endif %}>5</option>
          <option value="10" {% if pageSize == 10 %}selected{% endif %}>10</option>
          <option value="20" {% if pageSize == 20 %}selected{% endif %}>20</option>
        </select>
      </div>
      
      <button type="submit">Search</button>
    </form>
  </div>

  <!-- Search Results -->
  <div class="search-results">
    <h2>Search Results</h2>
    
    {% if query %}
      <p><strong>Search Query:</strong> "{{ query }}"</p>
    {% endif %}
    
    {% if category != 'all' %}
      <p><strong>Category:</strong> {{ category }}</p>
    {% endif %}
    
    <p><strong>Total Results:</strong> {{ totalResults }}</p>
    <p><strong>Page:</strong> {{ page }} of {{ totalPages }}</p>

    {% if hasResults %}
      <div class="results-list">
        {% for result in results %}
          <div class="result-item">
            <h3>{{ result.title }}</h3>
            <span class="category-badge">{{ result.category }}</span>
          </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if totalPages > 1 %}
        <div class="pagination">
          {% if pagination.hasPrevious %}
            <a href="/home/search?q={{ query | urlencode }}&category={{ category }}&page={{ pagination.previousPage }}&pageSize={{ pageSize }}">
              &laquo; Previous
            </a>
          {% endif %}

          {% for pageNum in pagination.pages %}
            {% if pageNum == page %}
              <span class="current-page">{{ pageNum }}</span>
            {% else %}
              <a href="/home/search?q={{ query | urlencode }}&category={{ category }}&page={{ pageNum }}&pageSize={{ pageSize }}">
                {{ pageNum }}
              </a>
            {% endif %}
          {% endfor %}

          {% if pagination.hasNext %}
            <a href="/home/search?q={{ query | urlencode }}&category={{ category }}&page={{ pagination.nextPage }}&pageSize={{ pageSize }}">
              Next &raquo;
            </a>
          {% endif %}
        </div>
      {% endif %}
    {% else %}
      <p>No results found.</p>
    {% endif %}
  </div>

  <!-- Debug Information -->
  <div class="debug-info">
    <h3>Query Parameters Debug</h3>
    <ul>
      {% for key, value in queryParams %}
        <li><strong>{{ key }}:</strong> {{ value }}</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Navigation -->
  <div class="navigation">
    <a href="/">Back to Home</a>
    <a href="/home/redirect-with-params">Demo Redirect with Params</a>
    <a href="/home/url-builder">URL Builder Demo</a>
  </div>
</div>

<style>
  .search-form {
    background: #f5f5f5;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  
  .form-group input,
  .form-group select {
    width: 100%;
    max-width: 300px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  
  .result-item {
    border: 1px solid #eee;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 4px;
    background: #fafafa;
  }
  
  .category-badge {
    background: #007bff;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8em;
  }
  
  .pagination {
    margin: 20px 0;
  }
  
  .pagination a,
  .pagination .current-page {
    display: inline-block;
    padding: 8px 12px;
    margin: 0 2px;
    border: 1px solid #ddd;
    text-decoration: none;
    border-radius: 4px;
  }
  
  .pagination .current-page {
    background: #007bff;
    color: white;
    border-color: #007bff;
  }
  
  .pagination a:hover {
    background: #f8f9fa;
  }
  
  .debug-info {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    padding: 15px;
    margin-top: 20px;
    border-radius: 4px;
  }
  
  .debug-info ul {
    margin: 0;
    padding-left: 20px;
  }
  
  .navigation {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #eee;
  }
  
  .navigation a {
    margin-right: 15px;
    color: #007bff;
    text-decoration: none;
  }
  
  .navigation a:hover {
    text-decoration: underline;
  }
</style>
{% endblock %}
